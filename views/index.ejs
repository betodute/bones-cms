<% layout('layouts/boilerplate') %>
<h1>Bones Blogging App</h1>
<% if (posts.length === 0) { %>
  <p>No posts yet.</p>
<% } else { %>
  <% posts.forEach(post => { %>
    <div class="card">
      <div class="card-body">
        <h2><%= post.title %></h2>
        <p><%= post.date.toLocaleDateString() %>, <%= post.date.toLocaleTimeString([], { hour: "numeric", minute: "2-digit" }) %></p>
        <p><%- addHashtagLinks(post.content) %></p>
        <p><a href="/posts/<%= post._id %>">View full post</a></p>
      </div>
    </div>
  <% }); %>
<% } %>

<% function addHashtagLinks(content) { %>
  <% const hashtagRegex = /#\w+\b/g; %>
  <% return content.replace(hashtagRegex, (match) => {
      return `<a href="/hashtags/${match.substring(1)}">${match}</a>`;
  }); %>
<% } %>